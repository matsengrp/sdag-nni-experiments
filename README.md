# NNI-Search Experiments

To view the results of the experiments, see the Jupyter notebook plot_results.ipynb.


## Dependencies and prerequisities

There are several dependencies and requirements before running an nni-search.

First, install bito and use the branch [xxx-nni-search-fixes](https://github.com/phylovi/bito/tree/xxx-nni-search-fixes). 

Second, update your bito environment based on the [watching-mb repo](https://github.com/matsengrp/watching-mb)
The full setup described there is not necessary, but you need to run the commands up to and including
`scripts/setup.sh`.

That is, move to the watching-mb repo and run the following:
```
conda activate bito
pip install -e .
conda env update --file environment.yml

git submodule update --init --recursive
make -C spr_neighbors
conda env config vars set WTCH_ROOT=$PWD
conda activate bito

scripts/setup.sh
```


## Performing an nni-search

For your first try, follow the instructions below and restrict to a top-pruning run on ds3
with uniform branch prior with 50 iterations. That will run in a short amount of time.


### Preparing the data files
Various data files are required to run an nni-search. These files are prepared for the ds-datasets,
assuming you have access to `/fh/fast/matsen_e/shared/vip/ds-golden/`, by running
```
prep-ds-data.sh
```
This script prepares files based on Mr. Bayes runs with both a uniform or exponential branch prior
on ds1, ds3, ds4, ds5, ds6, ds7, and ds8. You may want to edit the first few lines of the shell script
to restrict to a subset of these runs.


### Running the actual search
You can run the nni-search on these datasets and Mr Bayes posteriors with the script
```
run-nni-search.sh
```
This script requires you have prepared the data files with `prep-ds-data.sh`.
Again, you may want to edit the first few lines of the script to restrict to a subset.


### Getting additional statistics of the search
Additional information for the nni-search is generating by running the script
```
prep-post-search-data.sh
```
This script requires you have already run the nni-search with `run-nni-search.sh`.


### Getting similar statistics for MCMC
Comparison stats for short MCMC runs are generated by running the script.
```
prep-mb-data.sh
```
This script requires you have already prepared the data files with `prep-ds-data.sh`.



